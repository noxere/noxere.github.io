<!DOCTYPE html>
<html lang="en-us">
<title>Bounty Hunter (HTB) | Noxere - PenTest Machine Writeups</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.133.0">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://noxere.github.io/css/index.css">
<link rel="canonical" href="https://noxere.github.io/posts/bounty_hunter/">
<link rel="alternate" type="application/rss+xml" href="" title="Noxere - PenTest Machine Writeups">

<header>
  
    <a href="https://noxere.github.io/" class="title">Noxere - PenTest Machine Writeups</a>
  
  
</header>

<article>
  <header>
    <h1>Bounty Hunter (HTB)</h1>
    <time datetime="2024-08-27T18:30:25&#43;01:00">August 27, 2024</time>
  </header>
  <p><u>Enumeration</u></p>
<p>To begin with, I run an Nmap scan:</p>
  <p>
  <img src="../../assets/Nmap.png" alt="Nmap scan output" />
  </p>
<p>The initial scan shows 2 open ports - SSH on port 22 and Apache2 on port 80. I take a further look into port 80 through my browser.</p>
  <img src="../../assets/Homepage.png" alt="Website Home Page" />
<p>The webpage is for a team of bug bounty hunters. I run a gobuster directory scan in the background while continuing to explore the webpages. One interesting page I am able to navigate to is /log_submit.php through the nav bar at the top of the home page, which leads me to a web form that looks to be an exploit database beta test.</p>
  <img src="../../assets/Noinput.png" alt="Bounty Report System Beta - No input" />
  <img src="../../assets/Input.png" alt="Bounty Report System Beta - With input" />
<p>When I input some random data, my input is displayed on the page stating that it would have been added to the database, if it were ready. I fire up BurpSuite to catch this request and take a look.</p>
  <img src="../../assets/request.png" alt="BurpSuite request" />
  <img src="../../assets/base64validate.png" alt="base64 validation" />
<p>It appears that a POST request is submitted to /tracker_diRbPr00f314.php. The data in the request appears to be encoded with base64, as well as URL encoding. I use an encoding identifier to confirm this. Next, I forward the request to BurpSuite’s Decoder and decode as URL, then base64, to get the following output:</p>
  <img src="../../assets/base64.png" alt="First base64 from Burp Decoder" />
<p>The data we input from the POST request appears to be in XML format. With some research into XML exploits, it appears that this could be an entry point for a possible XXE injection. I send the original POST request to BurpSuite’s Repeater, take the following payload to read the /etc/passwd file, encode it as base64 and URL, then replace the data in the request with the encoded output.</p>
  <img src="../../assets/payload" alt="XXE Payload" />
<p>When I send the request, we get this response:</p>
  <img src="../../assets/Burpresponse.png" alt="Burpsuite passwd response" />
<p>Now that I know that the XXE injection works, I require additional enumeration to find the target file. The first gobuster scan yielded no results, so I run a second scan with the ‘-x php’ tag as we know the website runs PHP. The db.php file is discovered.</p>
  <img src="../../assets/gobuster.png" alt="Gobuster php file scan result" />
<p>As this is a Linux machine running Apache2, the /var/www/html/ path would be a good start to attempt to access this file. In order to extract this file, we must include a PHP filter in our request. We repeat the same process as before, with the new payload, and get this response: 
(Note: hacktricks.xyz is an extremely helpful resource for a better understanding in all of these areas, it helped me build the payloads used in this machine.)</p>
<p>As we can see, the response provided some base64 encoded data, I decode this to get the following:</p>
<p>I appear to have found some credentials, next step is to try and log in with these through SSH. I use the password against all users provided by the /etc/passwd file until we get a successful login with the ‘development’ user. Here we can find the user.txt in /home/development. </p>
  <p><u>Privilege Escalation</u></p>
<p>In the same directory as the user.txt file, there is a contract.txt file, which contains this message:</p>
<p>The message refers to an internal tool, which may be useful to us. Some more enumeration reveals an /opt/skytrain_inc/ directory, which contains a python script called ticketValidator.py, as well as another file containing some invalid tickets. ‘Sudo -l’ also tells us that we can run this script as root without needing a password, I will keep this in mind for later.</p> 
<p>To better understand the script, I use ChatGPT to break it down. The result of this shows me that the use of the `eval()` function may point to a vulnerability. Some important information to note from this script is the validation technique – It checks that the ticket code is divisible by 7 with a remainder of 4 and evaluates to a number greater than 100. </p>
<p>I need to create a ticket that meets these requirements, which will also grant me a root shell when executed. After some trial and error, I put together the following ticket:</p>
<p>I run the python script, point to the malicious ticket file and now have root access. The root flag is then found in the /root directory.</p>

  
</article>



</html>
